# Data Models - Indo Learning App

**Generated:** 2025-11-27T06:01:12+08:00  
**Data Storage:** JSON files + localStorage  
**Type System:** TypeScript

## Table of Contents

- [Word Data Model](#word-data-model)
- [Reading Text Data Model](#reading-text-data-model)
- [Application State Model](#application-state-model)
- [Storage Schema](#storage-schema)
- [Data Relationships](#data-relationships)

---

## Word Data Model

### WordEntry

The core vocabulary data structure stored in JSON files and managed in localStorage.

#### TypeScript Definition

```typescript
interface WordEntry {
  word: string                              // Indonesian word
  translation: string                       //Primary English translation
  examples: WordExample[]                   // Usage examples (3-5)
  alternative_translations: WordVariant[]   // Alternative translations (2+)
  similar_words: SimilarWord[]              // Related words (2+)
  other_forms: WordVariant[]                // Morphological variants (2+)
  level: WordLevel                          // Difficulty: '1' | '2' | '3' | '4'
  learned: boolean                          // User progress flag
  type: string                              // Word type (noun, verb, adjective, etc.)
  category: string                          // Semantic category
  notes: string                             // Additional context/usage notes
  "q&a": WordQA[]                           // Question-answer pairs
}
```

#### Sub-Models

**WordExample**
```typescript
interface WordExample {
  example: string          // Indonesian sentence
  translation: string      // English translation
}
```

**WordVariant**
```typescript
interface WordVariant {
  word: string             // Variant form
  examples: WordExample[]  // Usage examples for this variant
}
```

**SimilarWord**
```typescript
interface SimilarWord extends WordVariant {
  level: WordLevel         // Difficulty level of similar word
}
```

**WordQA**
```typescript
interface WordQA {
  qestions: string         // Question (typo in orig schema)
  answer: string           // Answer
}
```

**WordLevel**
```typescript
type WordLevel = '1' | '2' | '3' | '4'

// Level meanings:
// '1' - Beginner (basic greetings, common words)
// '2' - Elementary (everyday conversation)
// '3' - Intermediate (complex topics)
// '4' - Advanced (specialized vocabulary)
```

#### Example Data

```json
{
  "word": "buku",
  "translation": "book",
  "examples": [
    {
      "example": "Saya membaca buku",
      "translation": "I am reading a book"
    },
    {
      "example": "Buku ini sangat menarik",
      "translation": "This book is very interesting"
    }
  ],
  "alternative_translations": [
    {
      "word": "textbook",
      "examples": [
        {
          "example": "Buku pelajaran",
          "translation": "Textbook"
        }
      ]
    }
  ],
  "similar_words": [
    {
      "word": "majalah",
      "level": "2",
      "examples": [
        {
          "example": "Majalah berita",
          "translation": "News magazine"
        }
      ]
    }
  ],
  "other_forms": [
    {
      "word": "buku-buku",
      "examples": [
        {
          "example": "Banyak buku-buku",
          "translation": "Many books"
        }
      ]
    }
  ],
  "level": "1",
  "learned": false,
  "type": "noun",
  "category": "objects",
  "notes": "Common word for any type of book",
  "q&a": [
    {
      "qestions": "How do you say 'my book' in Indonesian?",
      "answer": "Buku saya"
    }
  ]
}
```

### Word Cardinality Rules

- **Examples:** 3-5 per word
- **Alternative Translations:** Minimum 2
- **Similar Words:** Minimum 2
- **Other Forms:** Minimum 2
- **Q&A:** Variable (generated by AI)

### Word Usage Types

```typescript
type WordType =
  | 'noun'
  | 'verb'
  | 'adjective'
  | 'adverb'
  | 'pronoun'
  | 'preposition'
  | 'conjunction'
  | 'interjection'
  | 'greeting'
  | 'question word'
  | 'time word'
  | 'modal'
  | 'negation'
  | 'quantifier'
```

### Word Categories

```typescript
type WordCategory =
  | 'common'          // Everyday words
  | 'objects'         // Physical objects
  | 'actions'         // Verbs/activities
  | 'descriptions'    // Adjectives
  | 'time'            // Temporal expressions
  | 'places'          // Locations
  | 'people'          // Person-related
  | 'food'            // Culinary
  | 'nature'          // Natural world
  | 'abstract'        // Abstract concepts
```

---

## Reading Text Data Model

### ParagraphData

Represents a paragraph in the reading interface.

```typescript
interface ParagraphData {
  id: string         // Unique identifier (UUID)
  content: string    // Paragraph text
  isLearned: boolean // User progress flag
}
```

### DisplayFormat

Reading text display modes.

```typescript
type DisplayFormat =
  | 'clean'              // Plain Indonesian text
  | 'word-translation'   // Word-by-word translation
  | 'partial-reveal'     // Progressive reveal
  | 'custom'             // User-defined format
```

### DayGroup

Groups paragraphs by learning day.

```typescript
interface DayGroup {
  day: number                                    // Day number (1-based)
  paragraphs: { para: string; index: number }[]  // Paragraph content + index
}
```

### StatisticsData

Learning progress metrics.

```typescript
interface StatisticsData {
  learnedCount: number        // Paragraphs marked learned
  totalSentences: number      // Total paragraphs
  wordCount: number           // Total words in content
  learnedWordCount: number    // Words in learned paragraphs
  learnedPercentage: number   // Percentage learned (0-100)
  daysPassed: number          // Days since start date
  totalDaysGoal: number       // Target learning days
}
```

### EnhancedReadingTextProps

Main reading component props.

```typescript
interface EnhancedReadingTextProps {
  content: string                                         // Full text content
  language?: 'en' | 'id'                                  // Source language
  model: string                                           // OpenRouter model
  onContentUpdate?: (newContent: string) => void          // Content change handler
  basePrompt: string                                      // AI generation prompt
  onUpdateBasePrompt?: (prompt: string) => void           // Prompt update handler
  onRegenerateBase: () => Promise<void>                   // Full regeneration
  formattedContent?: Record<string, string>               // Cached formatted versions
  onUpdateFormattedContent?: (formats: Record<string, string>) => void
  learnedParagraphs?: Record<string, boolean>             // Paragraph progress
  onUpdateLearnedParagraphs?: (learned: Record<string, boolean>) => void
  learningDays?: number                                   // Total learning days
  startDate?: string                                      // ISO date string
}
```

---

## Application State Model

### Global State (Zustand)

```typescript
interface AppStore {
  // User
  userName: string | null
  setUserName: (name: string) => void
  
  // Regeneration
  regenerateFn: (() => Promise<void>) | null
  setRegenerateFn: (fn: (() => Promise<void>) | null) => void
}
```

### Settings Model

Stored in localStorage as JSON.

```typescript
interface Settings {
  // Global
  theme: 'light' | 'dark'
  
  // Per-Task Settings
  tasks: Record<string, TaskSettings>
}

interface TaskSettings {
  learningDays: number          // Days to spread content
  selectedModel: string         // OpenRouter model ID
  basePrompt: string            // AI generation prompt
  customPrompt?: string         // User-defined prompt
}
```

### Paragraph State Model

Tracks learning progress per task.

```typescript
// Stored as: localStorage['paragraphStates']
type ParagraphStates = Record<string, TaskParagraphState>

interface TaskParagraphState {
  [taskId: string]: {
    startDate: string                  // ISO date string
    learnedParagraphs: Record<string, boolean>  // paragraph_id => learned
    formattedContent: Record<string, string>    // format => content
  }
}
```

### Sentence Store Model

Tracks sentence-level progress.

```typescript
interface SentenceStoreState {
  sentences: Record<string, SentenceProgress>
}

interface SentenceProgress {
  id: string
  learned: boolean
  lastReviewed?: string        // ISO date
  reviewCount: number
}
```

---

## Storage Schema

### JSON Files (`data/words/`)

#### File Structure
```
data/
└── words/
    ├── level-1.json    // Beginner words
    ├── level-2.json    // Elementary
    ├── level-3.json    // Intermediate
    └── level-4.json    // Advanced
```

#### File Format
```json
[
  {
    "word": "...",
    "translation": "...",
    // ... full WordEntry schema
  },
  // ... more words
]
```

#### Sizing
- **Level 1:** ~500-1000 basic words
- **Level 2:** ~1000-2000 words
- **Level 3:** ~2000-3000 words
- **Level 4:** ~1000-1500 advanced words

### localStorage Schema

#### Keys

| Key | Type | Purpose |
|-----|------|---------|
| `settings` | `Settings` | User preferences and task configs |
| `paragraphStates` | `ParagraphStates` | Learning progress by task |
| `wordProgress` | `Record<string, boolean>` | Individual word learning status |
| `sentences` | `SentenceStoreState` | Sentence-level progress |
| `userName` | `string` | User's name |

#### Storage Limits
- **localStorage:** ~5-10MB per domain
- **Typical Usage:** <1MB for all data

#### Data Persistence
- Survives browser sessions
- Cleared on browser cache clear
- Export/import not yet implemented

---

## Data Relationships

### Entity Relationship Diagram

```
┌─────────────┐
│  WordEntry  │
│  (JSON)     │
└──────┬──────┘
       │
       │ 1:N
       ▼
┌─────────────┐
│ WordExample │
└─────────────┘

┌─────────────┐
│  WordEntry  │
└──────┬──────┘
       │
       │ 1:N
       ▼
┌─────────────┐
│WordVariant  │
└─────────────┘

┌─────────────┐
│  Task       │
└──────┬──────┘
       │
       │ 1:1
       ▼
┌─────────────┐
│TaskSettings │
│(localStorage)
└──────┬──────┘
       │
       │ 1:N
       ▼
┌──────────────┐
│ParagraphData │
└──────┬───────┘
       │
       │ N:1
       ▼
┌─────────────┐
│  DayGroup   │
└─────────────┘
```

### Data Flow

```
JSON Files (Static)
       ↓
  word-service.ts (CRUD)
       ↓
  WordEntry Objects
       ↓
  UI Components
       ↓
  localStorage (Progress)
```

---

## Data Validation

### Runtime Validation

```typescript
// Word level validation
function isValidWordLevel(level: any): level is WordLevel {
  return ['1', '2', '3', '4'].includes(level)
}

// Word entry validation
function validateWordEntry(word: any): word is WordEntry {
  return (
    typeof word.word === 'string' &&
    typeof word.translation === 'string' &&
    Array.isArray(word.examples) &&
    word.examples.length >= 3 &&
    word.examples.length <= 5 &&
    isValidWordLevel(word.level)
  )
}
```

### Type Guards

```typescript
function isWordEntry(obj: unknown): obj is WordEntry {
  const entry = obj as WordEntry
  return (
    entry &&
    typeof entry.word === 'string' &&
    typeof entry.translation === 'string' &&
    typeof entry.level === 'string'
  )
}
```

---

## Data Migration

### Versioning
- Currently no version tracking
- Schema changes require manual migration

### Future Considerations
- Add `schemaVersion` field to data files
- Implement migration functions
- Backward compatibility layer

---

## Performance Considerations

### Vocabulary Loading
- **Strategy:** Load level on-demand
- **Caching:** In-memory after first load
- **Optimization:** Consider lazy loading large levels

### localStorage
- **Access:** Synchronous (fast)
- **Writes:** Batch updates when possible
- **Size:** Monitor with periodic cleanup

### Search Performance
```typescript
// O(n) linear search across words
// Acceptable for <5000 words per level
// Consider indexing for larger datasets
```

---

## Data Security

### Current State
✅ No sensitive user data stored  
✅ Progress data is user-local only  
⚠️ No encryption (localStorage is plaintext)  
⚠️ No backup/restore mechanism  

### Recommendations
1. Implement export/import for backup
2. Consider encrypted storage for production
3. Add data validation on all inputs
4. Sanitize word content before AI generation

---

**Related Documentation:**
- [API Documentation](./api-documentation.md) - Data access APIs
- [Development Guide](./development-guide.md) - Working with data
- [Architecture](./architecture.md) - Data flow patterns
